From 863d72f307c5923e999c7628eec6b7d8a16a2a42 Mon Sep 17 00:00:00 2001
From: bellma <bellma@nowhere>
Date: Mon, 11 Feb 2019 14:09:05 -0500
Subject: [PATCH] python3 support for attr_update.py

---
 cmake/Modules/GrPython.cmake | 2 +-
 cmake/Modules/GrSwig.cmake   | 2 +-
 python/iio/__init__.py       | 8 ++++----
 swig/CMakeLists.txt          | 4 ----
 5 files changed, 7 insertions(+), 11 deletions(-)

diff --git a/cmake/Modules/GrPython.cmake b/cmake/Modules/GrPython.cmake
index de329e90db..f65194d650 100644
--- a/cmake/Modules/GrPython.cmake
+++ b/cmake/Modules/GrPython.cmake
@@ -196,7 +196,7 @@ function(GR_PYTHON_INSTALL)
         file(TO_NATIVE_PATH ${PYTHON_EXECUTABLE} pyexe_native)

         if (CMAKE_CROSSCOMPILING)
-           set(pyexe_native "/usr/bin/env python")
+           set(pyexe_native "/usr/bin/env python3")
         endif()

         foreach(pyfile ${GR_PYTHON_INSTALL_PROGRAMS})
diff --git a/cmake/Modules/GrSwig.cmake b/cmake/Modules/GrSwig.cmake
index bd9fc8cb62..85b4c94ef6 100644
--- a/cmake/Modules/GrSwig.cmake
+++ b/cmake/Modules/GrSwig.cmake
@@ -117,7 +117,7 @@ macro(GR_SWIG_MAKE name)
     endif()

     #append additional include directories
-    find_package(PythonLibs 2)
+    find_package(PythonLibs 3)
     list(APPEND GR_SWIG_INCLUDE_DIRS ${PYTHON_INCLUDE_PATH}) #deprecated name (now dirs)
     list(APPEND GR_SWIG_INCLUDE_DIRS ${PYTHON_INCLUDE_DIRS})

diff --git a/python/iio/__init__.py b/python/iio/__init__.py
index edfce0ae62..70ac8a4b2e 100644
--- a/python/iio/__init__.py
+++ b/python/iio/__init__.py
@@ -26,9 +26,9 @@ description here (python/__init__.py).
 import os

 try:
-    from iio_swig import *
-    from iio_pluto_source_swig import *
-    from iio_pluto_sink_swig import *
+    from .iio_swig import *
+    from .iio_pluto_source_swig import *
+    from .iio_pluto_sink_swig import *
 except ImportError:
     dirname, filename = os.path.split(os.path.abspath(__file__))
     __path__.append(os.path.join(dirname, "..", "..", "swig"))
@@ -36,4 +36,4 @@ except ImportError:
     from iio_pluto_source_swig import *
     from iio_pluto_sink_swig import *

-from attr_updater import attr_updater
+from .attr_updater import attr_updater
diff --git a/swig/CMakeLists.txt b/swig/CMakeLists.txt
index cbc3371863..b042f27d67 100644
--- a/swig/CMakeLists.txt
+++ b/swig/CMakeLists.txt
@@ -29,10 +29,6 @@ endif(NOT iio_sources)
 # Include swig generation macros
 ########################################################################
 find_package(SWIG)
-find_package(PythonLibs 2)
-if(NOT SWIG_FOUND OR NOT PYTHONLIBS_FOUND)
-    return()
-endif()
 include(GrSwig)
 include(GrPython)

--
2.17.1
